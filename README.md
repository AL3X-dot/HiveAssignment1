# HiveAssignment1

STEPS

COPY THE FOLLOWING FILE sales_order_data.csv into the running docker container 

`docker cp sales_order_data.csv containerid:/opt`

## In hive server CLI run the following commands :

`hive`

![image](https://user-images.githubusercontent.com/62464117/221345599-cbc0184e-127a-42d2-9678-0e935a65ea8a.png)


`show databases;`

![image](https://user-images.githubusercontent.com/62464117/221345621-0d0ff57f-a977-4578-a1bc-4e45d1942c60.png)


`CREATE DATABASE hive_db;`

![image](https://user-images.githubusercontent.com/62464117/221345644-e6e85e50-85f6-4ca3-9183-dbb008af5ef9.png)


`USE hive_db;`

![image](https://user-images.githubusercontent.com/62464117/221345667-f29b1ee5-fc4e-4898-9b98-b3968e5c4f43.png)


`CREATE TABLE SALES_ORDER_DATA(
    ORDERNUMBER INT,
    QUANTITYORDERED INT,
    PRICEEACH FLOAT,
    ORDERLINENUMBER INT,
    SALES FLOAT,
    STATUS STRING,
    QTR_ID INT,
    MONTH_ID INT,
    YEAR_ID INT,
    PRODUCTLINE STRING,
    MSRP INT,
    PRODUCTCODE STRING,
    PHONE STRING,
    CITY STRING,
    STATE STRING,
    POSTALCODE STRING,
    COUNTRY STRING,
    TERRITORY STRING,
    CONTACTLASTNAME STRING,
    CONTACTFIRSTNAME STRING,
    DEALSIZE STRING
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE
tblproperties ("skip.header.line.count"="1");`


`DESCRIBE FORMATTED SALES_ORDER_DATA;`

![image](https://user-images.githubusercontent.com/62464117/221345781-a3e3d5b9-9a5f-4511-be50-45b0a76a2676.png)


LOAD DATA FROM CSV TO THE TABLE

`LOAD DATA LOCAL INPATH 'sales_order_data.csv' INTO TABLE SALES_ORDER_DATA;`

![image](https://user-images.githubusercontent.com/62464117/221345896-c3a7dfa3-7e9b-4ac1-a0d8-f8802d4a9243.png)


`set hive.cli.print.header=true;`

`SELECT * FROM SALES_ORDER_DATA LIMIT 10;`

![image](https://user-images.githubusercontent.com/62464117/221345955-07b6be0b-0d9a-44d6-8e44-ff29b136c64a.png)


CREATE TABLE TO STORE IN ORC FORMAT

`CREATE TABLE SALES_ORDER_ORC(
    ORDERNUMBER INT,
    QUANTITYORDERED INT,
    PRICEEACH FLOAT,
    ORDERLINENUMBER INT,
    SALES FLOAT,
    STATUS STRING,
    QTR_ID INT,
    MONTH_ID INT,
    YEAR_ID INT,
    PRODUCTLINE STRING,
    MSRP INT,
    PRODUCTCODE STRING,
    PHONE STRING,
    CITY STRING,
    STATE STRING,
    POSTALCODE STRING,
    COUNTRY STRING,
    TERRITORY STRING,
    CONTACTLASTNAME STRING,
    CONTACTFIRSTNAME STRING,
    DEALSIZE STRING
)
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS ORC
tblproperties ("skip.header.line.count"="1");`


LOAD DATA FROM SALES_ORDER_DATA TO SALES_ORDER_ORC

`INSERT INTO SALES_ORDER_ORC SELECT * FROM SALES_ORDER_DATA;`

![image](https://user-images.githubusercontent.com/62464117/221346049-9d749e56-c1d1-452e-904b-2c711cb540dc.png)


`SELECT * FROM SALES_DATA_ORC LIMIT 10;`

![image](https://user-images.githubusercontent.com/62464117/221346102-d7432237-efd9-435f-b258-a1b308d7cf9d.png)



START WITH QUERY EXECUTION 


1. QUERY TO CALCULATE TOTAL SALES PER YEAR

`SELECT YEAR_ID , SUM(SALES) AS TOTAL_SALES
FROM SALES_ORDER_ORC
GROUP BY (YEAR_ID);`

![image](https://user-images.githubusercontent.com/62464117/221346162-935216e2-d332-475d-b1f3-9c7cdafe5383.png)


2. QUERY TO FIND A PRODUCT WHICH WAS ORDERED THE MOST

`SELECT PRODUCTLINE , SUM(QUANTITYORDERED) AS TOTAL_UNITS 
FROM SALES_ORDER_ORC
GROUP BY (PRODUCTLINE)
ORDER BY TOTAL_UNITS DESC
LIMIT 1;`

![image](https://user-images.githubusercontent.com/62464117/221346220-a2d55d89-ab2d-4a67-9976-344e314ffd4d.png)


3. QUERY TO CALCULATE TOTAL SALES FOR EACH QUARTER

`SELECT YEAR_ID AS YEAR , QTR_ID AS QUARTER , SUM(SALES) AS TOTAL_SALES
FROM SALES_ORDER_ORC
GROUP BY QTR_ID , YEAR_ID
ORDER BY YEAR ,QUARTER ;`

![image](https://user-images.githubusercontent.com/62464117/221346279-7dd1c6ce-72e9-4c6e-a1c5-573d5841bba8.png)


4. QUERY TO CALCULATE MINIMUM SALES FOR A QUARTER

`SELECT YEAR_ID AS YEAR , QTR_ID AS QUARTER , SUM(SALES) AS TOTAL_SALES
FROM SALES_ORDER_ORC
GROUP BY QTR_ID , YEAR_ID
ORDER BY TOTAL_SALES LIMIT 1;`

![image](https://user-images.githubusercontent.com/62464117/221346320-6f65405e-4772-493f-8d11-fe0d55e6c285.png)


5.1 QUERY TO FIND OUT THE COUNTRY WHICH HAD MINIMUM SALE FOR A GIVEN YEAR

`WITH COUNTRY_YEAR_SALES AS (
SELECT COUNTRY ,YEAR_ID as YEAR, SUM(SALES) AS TOTAL_SALES
FROM SALES_ORDER_ORC
GROUP BY COUNTRY ,YEAR_ID),
CTE AS (
    SELECT * , ROW_NUMBER() OVER (PARTITION BY YEAR ORDER BY TOTAL_SALES) AS RN
    FROM COUNTRY_YEAR_SALES 
)
SELECT COUNTRY,YEAR,TOTAL_SALES FROM CTE WHERE RN = 1;`

![image](https://user-images.githubusercontent.com/62464117/221346392-1f0f30dc-d6dc-4abc-bb99-19fac8bb203e.png)


5.2. QUERY TO FIND OUT THE COUNTRY WHICH HAD MAXIMUM SALE FOR A GIVEN YEAR

`WITH COUNTRY_YEAR_SALES AS (
SELECT COUNTRY ,YEAR_ID as YEAR, SUM(SALES) AS TOTAL_SALES
FROM SALES_ORDER_ORC
GROUP BY COUNTRY ,YEAR_ID),
CTE AS (
    SELECT * , ROW_NUMBER() OVER (PARTITION BY YEAR ORDER BY TOTAL_SALES DESC) AS RN
    FROM COUNTRY_YEAR_SALES 
)
SELECT COUNTRY,YEAR,TOTAL_SALES FROM CTE WHERE RN = 1;`

![image](https://user-images.githubusercontent.com/62464117/221346422-bc26d1ca-051a-4d67-93fa-0eacfc7b82f2.png)


6. QUERY TO FIND QUATERLY SALES FOR EACH CITY

`SELECT CITY , YEAR_ID AS YEAR  , QTR_ID as QUARTER, SUM(SALES) AS TOTAL_SALES
FROM SALES_ORDER_ORC
GROUP BY CITY, YEAR_ID, QTR_ID
ORDER BY CITY , YEAR , QUARTER;`

![image](https://user-images.githubusercontent.com/62464117/221346464-7ebf8586-f272-4853-99d9-4923e2cdabe1.png)


7. QUERY TO FIND MONTH IN EACH YEAR FOR WHICH MAXIMUM QUANTITIES WERE SOLD

`WITH CTE AS (SELECT YEAR_ID , MONTH_ID , SUM(QUANTITYORDERED) AS TOTAL_QUANTITY
    FROM SALES_ORDER_ORC
    GROUP BY YEAR_ID , MONTH_ID
    ORDER BY YEAR_ID , MONTH_ID),
CTE2 AS (SELECT *,
    ROW_NUMBER() OVER (PARTITION BY YEAR_ID ORDER BY TOTAL_QUANTITY DESC) AS RN
    FROM CTE)
SELECT YEAR_ID , MONTH_ID , TOTAL_QUANTITY 
FROM CTE2 WHERE RN = 1;`

![image](https://user-images.githubusercontent.com/62464117/221346501-7489a6e0-6863-4750-bd38-428767b0e697.png)

